<!DOCTYPE html>
<html lang="en">
	<!-- 搜索附近 -->
	<head>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0">
		<link rel="stylesheet" href="./css/map.css">
		<title>信用卡支付</title>
	</head>

	<body> 
		<button id="checkout-button">Checkout</button>
	</body>
	<script src="./js/jquery.min.js"></script>
	<script src="https://js.stripe.com/v3/"></script>
	<script>
		let url = new URL(window.location.href);
		console.log(url)
		let Authorization = url.searchParams.get("isLogin");//用户token
		
		(function(){
		    console.log(Authorization)
		    const stripe = Stripe('pk_test_42xi7lAoc2wOsFfmZOq7etPS005IDp2SJJ')
		     const checkoutBtn = document.querySelector('#checkout-button')
		        /* checkoutBtn.addEventListener('click', () => {
		           var data = {
		           	"url": "http://47.95.239.228:8091/api/pay/stripe/?track=12"  ,
		           	"method": "get",
		           	"timeout": 0, 
		           	"headers": {
		           		"Authorization": Authorization,
		           		 "Content-Type": "application/json", 
		           	},  
		           	"crossDomain": true,
		           };
		           $.ajax(data).done(function (response) {
		           	    console.log(response);
		           }).fail(function(res) {
						console.log(JSON.stringify(res));
					});
				})*/
				checkoutBtn.addEventListener('click', () => {
					fetch('http://47.95.239.228:8091/api/pay/stripe/?track=12', {
						method: 'GET',
						headers: {
							"Authorization": Authorization,
		           		 	"Content-Type": "application/json"						
						}
					})
					.then(response => {
						console.log('response: ', response)
						return response.json()
					})
					.then(session => {
						return stripe.redirectToCheckout({ sessionId: session.id })
					})
					.then(result => {
						if(result.error) {
							console.log('redirect to checkout failed due to ', result.error.message)
						}
					})
					.catch(error => {
						console.log('error: ', error)
					})
				})

		    
			/*
			var data = {
				"url": "http://47.95.239.228:8091/api/pay/stripe/?track=12"  ,
				"method": "POST",
				"timeout": 0, 
				"headers": {
					"Authorization": Authorization,
					"Content-Type": "application/json", 
				},  
				"crossDomain": true,
			};
			$.ajax(data).done(function (response) {
				console.log(response);
			});*/
				/*
			fetch('/create-checkout-session/', {
				method: 'POST'
			})
			.then(response => {
				console.log('response: ', response)
				//return response.json()
			})
			.then(session => {
				return stripe.redirectToCheckout({ sessionId: session.id })
			})
			.then(result => {
				if(result.error) {
					console.log('redirect to checkout failed due to ', result.error.message)
				}
			})
			.catch(error => {
				console.log('error: ', error)
			})*/
		    
		})()
	</script>

</html>
